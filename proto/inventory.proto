syntax = "proto3";
package stateset.inventory;

import "google/protobuf/timestamp.proto";
import "common.proto";

message InventoryItem {
  int64 inventory_item_id = 1;
  string item_number = 2;
  string description = 3;
  string primary_uom_code = 4;
  int64 organization_id = 5;
  InventoryQuantities quantities = 6;
  repeated InventoryLocation locations = 7;
}

message InventoryQuantities {
  string on_hand = 1;  // Using string for Decimal precision
  string allocated = 2;
  string available = 3;
}

message InventoryLocation {
  int32 location_id = 1;
  string location_name = 2;
  InventoryQuantities quantities = 3;
  google.protobuf.Timestamp updated_at = 4;
}

message AdjustInventoryRequest {
  oneof identifier {
    int64 inventory_item_id = 1;
    string item_number = 2;
  }
  int32 location_id = 3;
  string quantity_delta = 4;  // Using string for Decimal precision
  string reason = 5;
  string idempotency_key = 6;
}

message AdjustInventoryResponse {
  InventoryLocation location_balance = 1;
}

message ReserveInventoryRequest {
  oneof identifier {
    int64 inventory_item_id = 1;
    string item_number = 2;
  }
  int32 location_id = 3;
  string quantity = 4;  // Using string for Decimal precision
  string reference_id = 5;
  string reference_type = 6;
}

message ReserveInventoryResponse {
  string reservation_id = 1;
  InventoryLocation location_balance = 2;
}

message ReleaseReservationRequest {
  oneof identifier {
    int64 inventory_item_id = 1;
    string item_number = 2;
  }
  int32 location_id = 3;
  string quantity = 4;  // Using string for Decimal precision
}

message ReleaseReservationResponse {
  InventoryLocation location_balance = 1;
}

message GetInventoryRequest {
  oneof identifier {
    int64 inventory_item_id = 1;
    string item_number = 2;
  }
}

message GetInventoryResponse {
  InventoryItem item = 1;
}

message ListInventoryRequest {
  uint64 page = 1;
  uint64 limit = 2;
  string product_filter = 3;
  int32 location_filter = 4;
  string low_stock_threshold = 5;  // Using string for Decimal precision
}

message ListInventoryResponse {
  repeated InventoryItem items = 1;
  uint64 total = 2;
  uint64 page = 3;
  uint64 per_page = 4;
}

message TransferInventoryRequest {
  int64 inventory_item_id = 1;
  int32 from_location_id = 2;
  int32 to_location_id = 3;
  string quantity = 4;  // Using string for Decimal precision
}

message TransferInventoryResponse {
  bool success = 1;
}

service InventoryService {
  rpc AdjustInventory (AdjustInventoryRequest) returns (AdjustInventoryResponse);
  rpc ReserveInventory (ReserveInventoryRequest) returns (ReserveInventoryResponse);
  rpc ReleaseReservation (ReleaseReservationRequest) returns (ReleaseReservationResponse);
  rpc GetInventory (GetInventoryRequest) returns (GetInventoryResponse);
  rpc ListInventory (ListInventoryRequest) returns (ListInventoryResponse);
  rpc TransferInventory (TransferInventoryRequest) returns (TransferInventoryResponse);
}